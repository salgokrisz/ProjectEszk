language: java

sudo: false

addons:
  sonarcloud:
    organization: "salgokrisz-github"
    token:
      secure: "$SONAR_TOKEN"
      
before_script: cd Cluedo

jobs:

  include:

    - stage: compile

      script: mvn compile
      
    - stage: test

      script: mvn test
      
    - stage: pmd
    
      script: 
             - mvn compile site
             - mvn pmd:pmd
             - mvn verify

    - stage: sonar    
    
      script: mvn org.jacoco:jacoco-maven-plugin:prepare-agent verify sonar:sonar -DskipTests=true -Dmaven.test.failure.ignore=true
    
    - stage: deploy
    
      script: skip
                 
      deploy:
            provider: releases
            api_key: 
               secure: "JJvFhLb5SgnCJs9xkv25LDb2wyC3hRc9DAGZ9astSI/UAeLIT4nfH1lDwY7eYxbwB7mABXBlrObevn5bDY/tfr2RgzzirwJJQT+GqZg6cTafjN9/SdLocCKrspudDi2F/2Bnvt9Ssm4xqe/mL0UTrdL9uRbPSZQTIMGyvzixus9DngUm24ITD43i3jM+pWlAV70tufVVLj2JBqI0KFSnHzJlCe9KvOEx9hDZMLgyg1MNg1mHk4YuaFtTCC8mC5t6De/bLtZYX6dVBN9WCgL9mD3NM1wGdytcA+dwagI8NHvOfQ3G1RYt7jcRcppY7GON4ehQ8+Jvt3lSHc7zAN0igJ0EwJ5AlgRRKucD2f+4hdeVEKuO3n4kDl54+tuEsiy50vmjSlXnMrBe/ooW6FMuiiuZ7xDpPyKYHUy58tmgB5u/gAS4NkrdX6EnOj+p3NJlG06UazosW//TfvHiJa51q7ZnWk6Vl2OvTaN8CwCcHbcJ6e4kjxZ9IG/csMufx+FjlgDwECnRquxAQYX0/EB8RtZw698Vhm4k1zlUKFAbLHQP4W3yDBkPfXRbsKwX+MTSGgqi1g1Om28zvVD9hwVo0IU21O4TR+9FTFsp1lalHlvFMi9TOiVVqbHteJXhXNSf2UAJWEk4t9V9BBOvwu7ws2m1d5w4+NH6hvflIvKEvMg="                    
            file: "Cluedo.jar"
            skip_cleanup: true
            on:
               branch: master

stages:

  - compile

  - test
  
  - pmd
  
  - sonar
  
  - deploy

  

